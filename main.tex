\documentclass[12pt,oneside,a4paper]{amsbook} % yksipuoleinen tulostus
%\documentclass[12pt,twoside,a4paper]{amsbook} % kaksipuoleinen tulostus
\input{sections/preamble.tex}
\begin{document}
% \subfile{sections/coverpage} % Kansilehti ym. coverpagen sisällä
\pagebreak
%%%% Esitiedot
\chapter{Esitiedot}

\section{Topologiset avaruudet}
\begin{definition}
    Topologinen avaruus on pari (X, T), missä $X$ on joukko ja $T$ on joukon $X$ osajoukkojen kokoelma, jonka alkioille pätee
    \begin{enumerate}
        \item $\displaystyle \emptyset \in T, X \in T$
        \item $\displaystyle \{A_i : i\in I\} \subset T \implies \bigcup_{i \in I} A_i \in T$
        \item $\displaystyle A, B \in T \implies A\cap B \in T$.
    \end{enumerate}
\end{definition}

Merkitään $2^A$ joukon $A$ osajoukkojen kokoelmaa.

\begin{definition}
    \textbf{Sigma-algebra. } Olkoon $X$ joukko. Tällöin $\Gamma \subset 2^X$ on \textit{sigma-algebra}, joukossa $X$, jos $\Gamma$ toteuttaa seuraavat ominaisuudet:
    \begin{enumerate}
        \item $\emptyset \in \Gamma$ 
        \item jos $A \in \Gamma$, niin $A^c \in \Gamma$
        \item jos $A_1, A_2, ... \in \Gamma$, niin $\bigcup_{j=1}^\infty A_j \in \Gamma$ 
    \end{enumerate}
    (Lehrbäck, MII, s. 86)
\end{definition}


\begin{definition}
    \textbf{Joukkoperheen virittämä sigma-algebra. } Olkoon $X$ joukko ja olkoon $\Delta \subset 2^X$. Tällöin 
        $$ \Gamma_\Delta = \bigcap \{\Gamma : \Gamma \text{ on sigma-algebra joukossa } X \text{ ja }  \Delta \subset \Gamma \}$$ 
    on joukkoperheen $\Delta$ \textit{virittämä} sigma-algebra joukossa $X$.
    (Lehrbäck, MII, s. 86)
\end{definition}

\begin{definition}
    \textbf{Borelin joukko:}
    Olkoon $X$ topologinen avaruus, ja 
    \[\Delta = \{A \subset X : A \text{ on avoin joukko}\} \subset 2^X \]
    Tällöin $\sigma$-algebra $\mathcal B = \mathcal B_n := \Gamma_\Delta$ on avaruuden $X$ \textit{Borelin} $\sigma$-\textit{algebra} ja joukkoja $A\in \mathcal B$ kutsutaan \textit{Borel-joukoiksi.} 
    (Lehrbäck, MII, s.87, muokattu)
\end{definition}


Sigma-algebran $\Gamma_\Delta$ määritelmän nojalla Borelin joukko on \textit{suppein} avoimista joukoista koostuva joukon $X$ sigma-algebra, joka sisältää joukkoperheen $\Delta$.

\begin{definition}
    \textbf{Borelin avaruus:} Olkoon $X\subset \R^n$ joukko ja $\Gamma$ sigma-algebra joukossa $X$. Tällöin pari $(X, \Gamma)$ on \textit{Borelin avaruus}. Borelin avaruudesta käytetään myös nimitystä \textit{mitallinen avaruus}. LÄHDE?
\end{definition}

\section{Metriset avaruudet}
\begin{definition}
    \textbf{etäisyys:} Joukon $X$ funktio $d: X\times X \to \R^+$ on \textit{etäisyys} joukossa $X$, jos kaikilla $x, y, z \in X$ pätee
    \begin{enumerate}
        \item $d(x,y) \ge 0$
        \item $d(x,y) = 0 \iff x = y$
        \item $d(x,y) = d(y,x)$
        \item $d(x,y) \ge d(x,z) + d(z,y)$
    \end{enumerate}
\end{definition}

\begin{definition}
    \textbf{metrinen avaruus} Olkoon $M$ joukko ja $d$ etäisyys joukossa $M$. Tällöin pari $(M, d)$ on \textit{metrinen avaruus}, merkitään $M = (M, d)$.
\end{definition}

\begin{definition}
    Jono $(p_n)$ metrisessä avaruudessa $M$ on \textit{Cauchyn jono}, jos kaikilla $\varepsilon > 0$ on olemassa $N\in \mathbf{\N}$ siten, että $d(p_n, p_m) < \varepsilon$ jos $n, m\ge N$. \cite[p.52]{principles}
\end{definition}

Täydelliseksi metriseksi avaruudeksi kutsutaan sellaista avaruutta, johon ei jää reikiä. Esimerkiksi reaalilukujen muodostama metrinen avaruus varustettuna tavallisella euklidisella normilla on täydellinen. Määritellään tarkasti, mitä tarkoittaa joukon täydellisyys. Motivaatio täydellisyyden määritelmään löytyy lähteestä \cite[p.54]{principles}.

\begin{definition}
    Metrinen avaruus on \textit{täydellinen}, jos avaruuden jokainen Cauchyn jono suppenee. 
\end{definition} 

\begin{definition}
    \textbf{peite} Olkoon $I$ indeksijoukko. Joukkojen kokoelma $C = \{C_i \subset M \colon i \in I\}$ metrisessä avaruudessa $M$ on joukon $C \subset M$ peite, jos 
    \begin{equation*}
        A \subset \bigcup_{i\in I}C_i.
    \end{equation*}
    Peitteen $C$ osapeite on joukon $C$ osajoukko, joka edelleen peittää joukon $A$. Peite $C$ on avoin peite, jos peittämiseen käytetyt joukot $C_i$ ovat avoimia. 
\end{definition}

\begin{definition}
    \textbf{kompakti metrinen avaruus} Metrinen avaruus $M$ on \textit{kompakti}, jos jokaisella avaruuden $M$ avoimella peitteellä on äärellinen osapeite. 
\end{definition}

\begin{definition}
    Metrinen avaruus $M$ on \textit{täysin rajoitettu}, jos kaikilla $\varepsilon > 0$ on olemassa äärellinen kokoelma avoimia $\varepsilon$-säteisiä palloja avaruudessa $M$, joiden yhdiste sisältää avaruuden $M$.
\end{definition}

\begin{definition}
Olkoon $X\subset \R^n$ ja $M$ metrinen avaruus. Funktion $f: X \to M$ sup-normi määritellään luvuksi
\begin{equation*}
    ||f||_\infty = \inf\{C \ge 0 : |f(x)| \le C \text{ melkein kaikilla } x\}.
\end{equation*}
Joukossa $A\subset M$ äärellisiä sup-normin arvoja saavien funktioiden avaruutta merkitään
    \[L^\infty (A) = \{f:A\to M \colon  ||f||_\infty < \infty\}.\] 
\end{definition}

\begin{definition}
    Olkoon $(M, d)$ metrinen avaruus ja $A \subset M$. Joukon $A$ halkaisija $\diam(A)$ määritellään supremumina
    \begin{equation*}
        \diam(A) = \sup\{d(x, y) : x,y \in A\}.
    \end{equation*}
\end{definition}




\begin{theorem}\label{thm:compactness}
    Jos metrinen avaruus $M$ on täysin rajoitettu ja täydellinen, niin se on kompakti.
\end{theorem}
\begin{proof}
Todistus:
    \url{https://math.stackexchange.com/questions/1883634/proofs-for-complete-totally-bounded-implies-compact/1889749}
\end{proof}

\section{Mittateoriaa}

\begin{definition}
    \textbf{Mitta} Oletetaan, että $X$ on joukko ja $\Gamma$ on $\sigma$-algebra joukossa $X$. Funktio $\mu : \Gamma \to [0, \infty]$ on \textit{mitta} (joukossa X tai $\sigma$-algebrassa $\Gamma$), jos 
    \begin{enumerate}
        \item $\mu(\emptyset) = 0$, \\
        ja
        \item Jos $A_1, A_2, ... \in \Gamma$ ovat erillisiä eli $A_i \cap A_j = \emptyset$ aina, kun $i \ne i$, niin
        $$\mu\left(\bigcup_{j=1}^\infty A_j \right) = \sum_{j=1}^\infty \mu(A_j).$$
    \end{enumerate}
    
    Kolmikkoa $(X,\Gamma, \mu)$ sanotaan \textit{mitta-avaruudeksi} ja joukkoja $A\in \Gamma$ sanotaan $\Gamma$-mitallisiksi.
    
    (Lehrbäck, MII, s. 88)
\end{definition}

\begin{definition}
    \textbf{Funktion mitallisuus:}Olkoon $(X, \Sigma)$ ja $(Y, \Gamma)$ metrisiä avaruuksia, missä $X$ ja $Y$ ovat joukkoja varustettuna sigma-algebroilla $\Sigma$ ja $\Gamma$. Funktio $f: X \to Y$ on mitallinen, jos kaikille $E\in \Gamma$ funktion $f$ alkukuva joukolle $E$ sisältyy kokoelmaan $\Sigma$, toisin sanoen kaikille $E \in \Gamma$
    \begin{equation*}
        f^{-1} = \{x \in X : f(x) \in E\} \in \Sigma.  
    \end{equation*}
\end{definition}

\begin{definition}
     Olkoon $X$ joukko ja $\Gamma \subset 2^X$ sigma-algebra. Olkoon $A\in \Gamma$. Funktio $f: A \to \R \bigcup\{-\infty, \infty\}$ on \textit{$\Gamma$-mitallinen}, jos kaikille $a \in \R$ pätee, että
    \begin{equation*}
        \{x \in A : f(x) > a\} = f^{-1}(]a, \infty]) \in \Gamma.
    \end{equation*} 
    Jos $\mu:\Gamma \to \Rp$ on mitta ja $f$ on $\Gamma$-mitallinen, sanotaan, että $f$ on $\mu$-mitallinen.
    
    (Lehrbäck MII, s. 110)
\end{definition}

\begin{theorem} \label{thm:monoConvThm}
    (Monotonisen konvergenssin lause). Olkoon $(X, \mathcal{B}, \mu)$ mitta-avaruus ja olkoot $f_n:X\to [0, \infty]$ mitallisia funktioita siten, että funktiojono $(f_k)$ on kasvava. Tällöin
    \begin{equation*}
        \lim_{n\to\infty} \int_X f_n \, d\mu = \int_X \lim_{n\to \infty} f_n \, d\mu
    \end{equation*}
\end{theorem}
\begin{proof}
    Todistus löytyy lähteestä \cite[p. 107]{MeasureTheoryTao}.
\end{proof}

\begin{definition}
    \textbf{Lebesguen ulkomitta:} Funktio $m^* : \R^n \to \R^+$ on \textit{Lebesguen ulkomitta} kun määritellään
    $$m^*(A) = \inf\left\{\sum_{i=1}^\infty v(I_i) : I_i \in \mathcal K_n \text{ ja } A \subset \bigcup_{i=1}^{\infty}I_i\right\} \text{ kaikille } A \subset \R^n$$
\end{definition}
\whytho{Päätä merkinnät: m tai $\lambda$}
\begin{definition}
    \textbf{Lebesgue-mitalliset joukot:} Joukko $A\subset \R^n$ on \textit{Lebesgue-mitallinen}, jos kaikille $E\subset \R^n$ pätee
    $$m^*(E) = m^*(E \, \backslash \, A) + m^*(E\cap A)$$
    Kaikkien avaruuden $\R^n$ Lebesgue-mitallisten joukkojen kokoelmaa merkitään 
    $$\mathcal M = \mathcal M_n = \left\{A\subset \R^n \colon A \text{ on Lebesgue-mitallinen} \right\}.$$
    (Lehrbäck, MII, s. 27)
\end{definition}

\begin{definition}
    \textbf{Lebesguen mitta} Funktio $\lambda : \mathcal M \to \R^+$ on \textit{Lebesguen mitta} kun määritellään
    $$m(A) = m^*(A) \text{ kaikille } A\subset \mathcal M.$$
\end{definition}

\begin{definition}
Olkoon $\Sigma$ sigma-algebra joukossa $X$ ja $\mu:\Sigma \to [0,1]$ mitta joukossa $X$. Jos $\mu(X) = 1$, niin tällöin $\mu$ on \textit{todennäköisyysmitta} joukossa $X$, merkitään $\mu \in \mathcal{P}(X)$. 
    Kolmikkoa $(X, \Gamma, \mu)$ kutsutaan tällöin \textit{todennäköisyysavaruudeksi}.
\end{definition}

\begin{theorem}\label{thm:markov}
    (Markovin epäyhtälö) Olkoon $(X, \Sigma, \mu)$ mitta-avaruus ja $f$ $A$-mitallinen funktio, kun $A \in \Sigma$. Tällöin
    \begin{equation*}
        \mu(\left\{x \in A : |f(x)| \ge t\right\}) \le \frac{1}{t}\int_A |f| \, d\mu.
    \end{equation*}
    kaikilla $t\in \Rp$.
\end{theorem}
\begin{proof}
    Todistus löytyy lähteestä \url{https://proofwiki.org/wiki/Markov%27s_Inequality}.
\end{proof}


\begin{definition}
    \textbf{Push-forward:} Olkoon Borelin avaruudet $(X_1, \Sigma_1)$ ja $(X_2, \Sigma_2)$, mitallinen funktio $f:X_1 \to X_2$ ja mitta $\mu: \Sigma_1 \to \R^+$. Mitan $\mu$ \textit{pusku} on mitta $f_\#\mu: \Sigma_2 \to \R^+$, kun määritellään
    $$f_\# \mu (B) = \mu(f^{-1}(B)) \text{ kaikilla } B\in \Sigma_2.$$
\end{definition}

\subsection{Puolijatkuvuus ja Lipschitz-jatkuvuus}
Olkoon $X$ ja $Y$ metrisiä avaruuksia.

\begin{definition} \textbf{Jatkuvuus}. Merkitään jatkuvien funktioiden $f: X \to Y$ kokoelmaa $C(X, Y)$ tai $C(X)$.
\end{definition}

\begin{definition}
Funktioiden $f:X \to Y$ kokoelma $F$ on \textit{tasajatkuva pisteessä} $x_0 \in X$, jos kaikilla $\varepsilon > 0 $ on olemassa $\delta > 0$ siten, että $d(f(x_0), f(x)) < \varepsilon$ kaikille $f \in F$ ja kaikille $x \in X$ joille $d(x_0, x) < \delta $. Kokoelma $F$ on $tasajatkuva$, jos $F$ on tasajatkuva kaikilla $x \in X$.
\end{definition}

\begin{theorem}\label{thm:ascoli-arzela}
    \textbf{Arzela-Ascoli:}
    Olkoon $F \subset C(\Rp)$. Tällöin $F$ on täysin rajoitettu jos ja vain jos se on tasajatkuva ja \define{pisteittäin rajoitettu.}
\end{theorem}

\begin{definition}
    \textbf{Alhaalta puolijatkuvuus:} Olkoon $X\subset \R^n$. Funktio $f: X \to \R \cup\{-\infty, \infty\}$ on \textit{alhaalta puolijatkuva} pisteessä $x_0$ jos 
    $$\liminf_{x\to x_0}  f(x) \ge f(x_0).$$
\end{definition}

\begin{definition}
    \textbf{Ylhäältä puolijatkuvuus:} Olkoon $X\subset \R^n$. Funktio $f: X \to \R \cup\{-\infty, \infty\}$ on \textit{ylhäältä puolijatkuva} pisteessä $x_0$ jos 
    $$\limsup_{x\to x_0}  f(x) \le f(x_0).$$
\end{definition}

\begin{lemma}\label{le:LSCimpliesMeasurable}
    Olkoon mitta $\mu: 2^X\to \Rp$. Jos funktio $f:X \to \Rp$ on alhaalta puolijatkuva, niin se on $\mu$-mitallinen.
\end{lemma}

\begin{definition}
    \textbf{1-Lipschitz-kuvaus:} Olkoon metriset avaruudet $(X, d_x)$ ja $(Y, d_y)$. Funktio $f:X\to Y$ on \textit{K-Lipschitz-jatkuva}, jos on olemassa $K\ge 0$ s.e. kaikille $x_1,x_2 \in X$
    $$d_y(f(x_1),f(x_2)) \le Kd_x(x_1,x_2).$$

\end{definition}



\section{Tarvitaanko / mihin kohtaan?}


\begin{definition}
    Caratheodoryn funktio
\end{definition}


%%%% Liikennesuunnitelmat
\chapter{Liikennesuunnitelmat}

Tämän tutkielman tavoitteena on rakentaa massansiirtämiseen liittyvää teoriakehystä, pääosin niin kutsuttujen \textit{liikennesuunnitelmien} avulla. Lopulta osoitetaan, että on olemassa liikennesuunnitelma, joka minimoi kuljetusongelman energian, joka määritellään myöhemmin. Aloitetaan rajaamalla tarkasteltavien kuljetusreittien eli polkujen avaruutta. 

Rajoitetaan tarkasteltavien polkujen joukko 1-Lipschitz-kuvauksiin, jotka kuvautuvat johonkin kompaktiin $\R^n$ osajoukkoon $X$. Merkitään kaikkien tällaisten 1-Lipschitz kuvauksien $\gamma: \Rp \to X$  joukkoa $K$. 

\begin{definition}
    Määritellään etäisyys joukossa $K$ siten, että
    \[d(\gamma, \gamma') = \sup_k \frac{1}{k}||\gamma - \gamma'||_{L^\infty([0,k])}.\]
\end{definition}

\begin{lemma}\label{le:compactnessOfK}
    Metrinen avaruus $(K, d)$ on kompakti.
\end{lemma}
\begin{proof}
    Todistus mukailee lähdettä \cite[p.26]{OptimalTransportationNetworks}. \\
    Osoitetaan väite todistamalla, että avaruus $K$ täydellinen ja täysin rajoitettu, jolloin Lauseesta $\ref{thm:compactness}$ seuraa kompaktius.
    
    Osoitetaan ensin, että avaruus $K$ on täydellinen, eli että kaikki avaruuden $K$ Cauchyn jonot suppenevat johonkin joukon $K$ alkioon. Olkoon $(\gamma_i)$ Cauchyn jono joukossa K ja $t\in \Rp$. Osoitetaan, että tällöin myös $(\gamma_i(t))$ on Cauchyn jono joukossa $X$. Olkoon kokonaisluku $k \ge t$. Koska $\gamma_i$ on Cauchyn jono, on kaikille $\varepsilon > 0$ olemassa $n \in \N$ siten, että $d(\gamma_i, \gamma_j) < \varepsilon$ jos $i, j \ge n$. Olkoon $\varepsilon > 0$. Tällöin on siis olemassa $n \in \N$, jolle
    \begin{align*}
        ||\gamma_i(t)-\gamma_j(t)|| &\le k\frac{1}{k} ||\gamma_i - \gamma_j||_{L^\infty{([0,k])}} \\ 
        &\le k d(\gamma_i, \gamma_j) \le k\varepsilon
    \end{align*}
    kaikilla $i, j \ge n$. Siispä $(\gamma_i(t))$ on myös Cauchyn jono.
    
    Koska $X$ on täydellinen, suppenee Cauchyn jono $(\gamma_i(t))$ johonkin joukon $X$ alkioon $\gamma(t)$. Osoitetaan, että tällä tavoin määritelty $\gamma$ on 1-Lipschitz, jolloin $\gamma \in K$. Olkoon $t, s \in \Rp$. Koska $\gamma_i \to \gamma$, niin kaikille $\varepsilon > 0$ on olemassa $n\in \N$, jolloin
    \begin{align*}
        ||\gamma(t) - \gamma(s)|| &= ||\gamma(t) - \gamma_i(t) + \gamma_i(s) - \gamma(s) + \gamma_i(t) - \gamma_i(s)|| \\
        &\le  ||\gamma(t) - \gamma_i(t)|| + ||\gamma_i(s) - \gamma(s)|| + ||\gamma_i(t) - \gamma_i(s)|| \\
        &\le \varepsilon/2 + \varepsilon/2 + ||\gamma_i(t) - \gamma_i(s)||
    \end{align*}
    kaikilla $i \ge n$. Koska $\gamma_i$ on 1-Lipschitz, niin $||\gamma_i(t) - \gamma_i(s)|| = |t-s|$. Siispä
    \begin{align*}
        ||\gamma(t) - \gamma(s)|| &\le |t-s| + \varepsilon
    \end{align*}
    kaikilla $\varepsilon > 0$, joten kaikilla $t,s \in \Rp$
    \begin{equation*}
        ||\gamma(t)-\gamma(s)|| = |t-s|.
    \end{equation*}
    Siispä $\gamma$ on 1-Lipschitz, ja siten $\gamma \in K$, joten $K$ on täydellinen.
    
    Osoitetaan, että $K$ on täysin rajoitettu. Olkoon $\varepsilon > 0$. Asetetaan $k_0$ siten, että 
    \begin{equation*}
        \sup_{k\ge k_0} \left(\frac{1}{k}\text{ diam(X)}\right) < \frac{\varepsilon}{2}.
    \end{equation*}
    Olkoon joukko $K_{k_0} \subset K$, jonka polkujen pysähdysaika on pienempää kuin $k_0$, eli
    \begin{equation*}
        K_{k_0} = \{\gamma \in K : T(\gamma) \le k_0\}.
    \end{equation*}
    Osoitetaan seuraavaksi, että kaikki joukon $K$ alkiot ovat korkeintaan etäisyyden $\varepsilon/2$ päässä joukon $K_{k_0}$ alkioista.
        Olkoon $\gamma \in K$. Määritellään $\tilde \gamma : \Rp \to X$,
    \begin{equation*}
        \tilde\gamma(t) = \begin{cases}
            \gamma(t), &\text{ kun } 0 \le t \le k_0 \\
            \gamma(k_0), &\text{ kun } t > k_0
        \end{cases}.
    \end{equation*}
    Polku $\tilde\gamma$ on edelleen 1-Lipschitz-jatkuva, joten $\tilde\gamma \in K_{k_0}$ ja 
    \begin{align*}
        d(\gamma, \tilde\gamma) &= \sup_{k \in \N} \frac{1}{k}||\gamma - \gamma'||_{L^\infty[0, k]} \\
        &\le \sup_{k \in \N} \left(\frac{1}{k}\text{ diam(X)}\right)\\
        &= \sup_{k > k_0} \left(\frac{1}{k}\text{ diam(X)}\right) < \frac{\varepsilon}{2}.
    \end{align*}
    Siispä polulle $\gamma \in K$ löydetään aina polku $\tilde\gamma \in K_{k_0}$ joka on halutun etäisyyden päässä.
    
    Osoitetaan, että $K_{k_0}$ on täysin rajoitettu. Joukko $K_{k_0}$ on tasajatkuva 1-Lipschitz-jatkuvien funktioiden kokoelmana. Lisäksi kaikille $x\in \Rp$ joukko $\{f(x) : f \in K_{k_0}\}\subset X$ on rajoitettu, joten $K_{k_0}$ on \whytho{pisteittäin rajoitettu}. Siispä Lauseesta \ref{thm:ascoli-arzela} seuraa, että joukko $K_{k_0}$ on täysin rajoitettu avaruudessa $C([0, k_0], \R^N)$ varustettuna normilla $||\cdot ||_\infty$.
    
    Koska $K_{k_0}$ on täysin rajoitettu, on olemassa äärellinen kokoelma joukon $K_{k_0}$ $\varepsilon/2$-säteisiä palloja, joiden yhdiste sisältää joukon $K_{k_0}$. Tutkimalla $\varepsilon$-säteisten pallojen kokoelmaa, joiden keskukset ovat samat kuin edellisen $\varepsilon/2$-säteisten pallojen kokoelma, saadaan äärellinen kokoelma $\varepsilon$-säteisiä palloja, merkitään tämän kokoelma joukkojen yhdistettä $B$. Koska kaikki joukon $K$ alkiot ovat korkeintaan etäisyyden $\varepsilon/2$ päässä joukon $K_{k_0}$ alkioista, löydetään jokaiselle joukon $K$ alkiolle pallo, johon se sisältyy. Tällöin $K$ voidaan peittää pallojen yhdisteellä $B$. Siispä $K$ on täysin rajoitettu.
    
    Koska $K$ on täydellinen ja täysin rajoitettu, on se Lauseen \ref{thm:compactness} nojalla kompakti.
    \end{proof}

\begin{definition}
    Määritellään polun $\gamma \in K$ pysähtymisajaksi 
    \begin{equation*}
        T(\gamma) = \inf\{t\ge0:\gamma(t) \text{ vakio välillä } [t,\infty[ \}
    \end{equation*}
    ja pituudeksi $L(\gamma)$ polun pituus välillä $[0, T(\gamma)]$ eli
     \begin{equation*}
         L(\gamma) = \int_0^{T(\gamma)}|\gamma'(t)|\, \dt.
     \end{equation*}
\end{definition}

Polun pysähtymisaika kuvastaa sitä, mistä parametrin arvosta $t$ lähtien polun $\gamma$ pisteet pysyvät paikallaan. Massansiirron näkökulmasta, mikäli polkua $\gamma$ pitkin siirretään massaa, sen kuljetukseen kestää aikaa $T(\gamma)$ verran. Avaruudessa $K$ on luonnollisesti polkuja, jotka ovat äärettömän pitkiä tai eivät muuten pysähdy. Määritellään tämä mielessä pitäen liikennesuunnitelma, joka painottaa polkuja siten, että pysähtymättömät polut eivät näy tarkastelussa.

\begin{definition}\label{def:liikennesuunnitelma}
    Mitta $\P: 2^K \to \R^+$ joukossa $K$ on \textbf{liikennesuunnitelma}, jos
    \begin{equation*}
     \int_K T(\gamma) \, \d \P (\gamma) < \infty.   
    \end{equation*}
    Merkitään lisäksi joukon $X$ liikennesuunnitelmien kokoelmaa $TP(X)$. \whytho{Mutta $\P$ on mitta joukossa $X$...}
\end{definition}

Liikennesuunnitelman määritelmä sallii, että $\P$-nollamittainen
joukko polkuja $\gamma$ on pysähtymisajaltaan äärettömiä, eli joille $T(\gamma) = \infty$. 

\begin{definition}
    Olkoon $\P$ liikennesuunnitelma. Merkitään joukon $X$ kaikkia liikennesuunnitelmia $TP = TP(X)$, ja $TP_C = TP_C(X)$ kaikkia joukon $X$ liikennesuunitelmia $\P$ joille
    \begin{equation*}
        \int_K T(\gamma) \d \P(\gamma) \le C.
    \end{equation*}
\end{definition}

Otetaan käyttöön kuvaukset, jotka palauttavat polun lähtöpisteen, päätepisteen ja näistä pisteistä muodostetun parin.

\begin{definition}
    Olkoon $\pi_0, \pi_\infty: K\to X$ ja $\pi:K\to X \times X$ kuvauksia, jotka määritellään polulle $\gamma \in K$ siten, että 
    \begin{align*}
        \pi_0(\gamma) &= \gamma(0), &&\Big| \text{ Polun lähtöpiste. }\\
        \pi_\infty(\gamma) &= \gamma(T(\gamma)), &&\Big| \text{ Polun päätepiste. }\\
        \pi(\gamma) &= (\gamma(0), \gamma(T(\gamma)). &&\Big| \text{ Polun lähtöpiste ja päätepiste. }
    \end{align*}
\end{definition}

\whytho{Entä jos $T(\gamma) = \infty?$}

Näiden kuvausten avulla voidaan määritellä mitat, jotka toimivat massojen mallintamisessa. Massa, joka halutaan siirtää, tullaan mallintamaan niin kutsutulla irrigoivalla mitalla, kun taas massa joka on jo siirretty mallinnetaan vastaavasti irrigoidulla mitalla. Näiden lisäksi määritellään siirtosuunnitelma, joka sisältää tiedon siitä, minne mikäkin massa halutaan siirtää.

\begin{definition}
    Olkoon $\P$ liikennesuunnitelma. Määritellään mitat $\mu^+, \mu^- : X \to \mathbf{R}_+$ ja $\pi: X\times X \to \mathbf{R}_+$ siten, että
    \begin{align*}
        \mu^+(\P) &= \pi_{0\#} \P,  &&\Big| \text{ Irrigoiva mitta, \textit{irrigating measure} }\\
        \mu^-(\P) &= \pi_{\infty \#} \P,  &&\Big| \text{ Irrigoitu mitta, \textit{irrigating measure} }\\
        \pi(\P) &= \pi_\# \P,  &&\Big| \text{ Siirtosuunnitelma liikennesuunnitelmalle $\P$,}\\ 
        & &&\hphantom{\Big|} \text{ \textit{transference plan of $\P$}}
    \end{align*}
\end{definition}

Testaamalla näiden mittojen määritelmää sopiville joukoille, saadaan niistä parempi ymmärrys.

\begin{remark}
    Kaikille Borelin joukoille $A, B \subset X$ pätee
    \begin{align*}
        \mu^+(\P)(A) &= \P(\pi_0^{-1}(A)) = \P(\{\gamma \in K : \gamma(0) \in A\}) \\
        \mu^-(\P)(B) &= \P(\pi_\infty^{-1}(B)) = \P(\{\gamma \in K : \gamma(\infty) \in B\}) \\
        \pi(\P)(A\times B) &= \P(\pi(A\times B)) = \P(\{\gamma \in K: \gamma(0) \in A\text{ ja } \gamma(\infty) \in B)\}
    \end{align*}
\end{remark}

Edellistä huomautusta tullaan käyttämään myöhemmin siirtymään joukkojen $X$ ja $K$ muodostamien metristen avaruuksien välillä.


\section{Parametrisoidut liikennesuunnitelmat}

\begin{theorem}\label{thm:skorohkod}
    Olkoon $\P: K \to \R^+$ liikennesuunnitelma. Tällöin on olemassa mitallinen funktio $\chi: [0, c] \to K$ siten, että liikennesuunnitelma voidaan kirjoittaa muodossa $$\P =\chi_\# \lambda.$$
\end{theorem}
\begin{proof}
    Lause seuraa Skorohkodin lauseesta, joka on todistettu esitelty ja todistettu lähteessä \cite[p. 185]{OptimalTransportationNetworks}.
\end{proof}
Edellisen lauseen mukaan mikä tahansa liikennesuunnitelma $\P$ voidaan parametrisoida mitallisella funktiolla $ \chi: [0, c] \to K$ s. e. $\P = \chi_\# \lambda$, missä $\lambda$ on Lebesguen mitta välille $[0,c]$. 

Funktio $ \chi:[0, c] \to K$ antaa siis jokaiselle välin $[0, c]$ luvulle 1-Lipschitz-polun joukosta $K$. 
Merkitään jatkossa $\Omega = [0,c]$ ja kutsutaan väliä indeksijoukoksi. Polku $ \chi(\omega)$ vastaa siis indeksin $\omega$ hiukkasen reittiä.

Merkitään nyt $\chi(\omega, t) :=  \chi(\omega)(t)$ kaikille $\omega \in \Omega$ ja $t \in \R^+$. Osoitetaan seuraavaksi, että myös näin määriteltynä on mitallinen funktio. Mitallisuuden osoittamiseksi esitellään seuraava Lemma.

\begin{lemma}\label{le:caratheodoryIsMeasurable}
    Olkoon $f:\Omega \times \Rp \to \R$ funktio, jolle
    \begin{itemize}
        \item $\omega \mapsto f(\omega, t)$  on mitallinen kaikilla $t \in \Rp$.
        \item $t \mapsto f(\omega, t)$ on jatkuva kaikilla $\omega \in \Omega$
    \end{itemize}
    Tällöin $f$ on mitallinen sigma-algebran suhteen, joka saadaan tulona joukkojen $\Omega$ ja $\Rp$ Lebesgue-mitallisista osajoukkojen kokoelmista.
\end{lemma}
\begin{proof}
    Olkoon $\Qp = \Q \cap \Rp$ ja $a, b \in \Qp$. Määritellään kaikille $c > 0$ ja $\varepsilon$ joukot 
    \begin{align*}
        U &= \{(\omega, t) \in \Omega\times \Rp : f(\omega, t) > c,\} \\
        V_\varepsilon(a, b) &= \{\omega \in \Omega : f(\omega, s) > c + \varepsilon \text{ kaikilla } s \in [a,b]\cap \Qp\}.
    \end{align*}
Osoitetaan, että
\begin{equation*}
    U = \bigcup_{a, b, \varepsilon \in \Qp} V_\varepsilon(a,b) \times [a,b].
\end{equation*}
Osoitetaan inkluusio $\supset$. Olkoon $(\omega, t) \in [a, b] \times V_\varepsilon(a, b)$. Tällöin kaikille $s\in [a, b] \cap \Qp$ pätee $f(\omega, s) > c + \varepsilon$. Koska $t \mapsto f(\omega, t)$ on oletuksen nojalla jatkuva, niin 
    \begin{equation*}
        f(\omega, t) = \lim_{s\to t} f(\omega, s) > \lim_{s\to t} c + \varepsilon > c.
    \end{equation*}
mikä osoittaa inkluusion. 

Osoitetaan inkluusio $\subset$. Olkoon $(\omega, t) \in \Omega \times \Rp $ jolle $f(\omega, t) > c$. Tällöin on olemassa $\varepsilon > 0$ jolla $f(\omega, t) > c + 2\varepsilon$. Funktion $f$ jatkuvuuden nojalla voidaan valita $a$ ja $b$ siten, että kaikilla $s \in [a, b]$ pätee $f(\omega, s) > c + \varepsilon$ ja $t\in [a,b]$, mikä osoittaa inkluusion.

Osoitetaan lopulta, että $V_\varepsilon(a,b)$ on mitallinen. Koska funktio $t \mapsto f(\omega, t)$ on mitallinen kaikilla $t \in D$, niin kaikille $a, b, \varepsilon$ joukko $V_\varepsilon(a, b)$ on mitallinen numeroituvana \whytho{mitallisten joukkojen leikkauksena.} 
\end{proof}

\begin{lemma}\label{le:chiMeasurable}
    Jos funktio $ \chi: \Omega \to K$ on mitallinen niin funktio $\chi: \Omega \times \R^+ \to X $ on mitallinen.
\end{lemma}
\begin{proof}
Todistus seuraa lähdettä \cite[p. 27]{OptimalTransportationNetworks}.
Määritellään jatkuva funktio $\pi_t:K \to X$, $\pi_t(\gamma) = \gamma(t)$. Tällöin yhdistetty kuvaus $\omega \mapsto \pi_t \circ \chi (\omega, \cdot)$ on mitallinen, joten $\omega \mapsto \chi(\omega, t)$ on mitallinen kaikilla $t$. Olkoon $B(x, r) \subset X$. Lemman \ref{le:caratheodoryIsMeasurable} nojalla funktio $f(\omega, t) = ||\chi(\omega, t) - x||$ on mitallinen. Siispä $f^{-1}([0,r[) = \chi^{-1}(B(x,r))$ on mitallinen joukon $\Omega \times \Rp$ osajoukko, ja siten $\chi:\Omega \times \Rp \to X $ on mitallinen.
\end{proof}
Funktion $\chi$ pysähdysaika määritellään vastaavasti, kuten liikennesuunnitelman $\P$ pysähdysaika.
\begin{definition}
    Jos $\chi: \Omega \times \R^+ \to X$ on mitallinen, niin sen \textit{pysähdysaika} $T_\chi$ on
    \[T_\chi (\omega) = \inf\{t : \chi(\omega, t) \text{ on vakio välillä } [t,\infty[\}.\]
\end{definition}

Määritellään seuraavaksi, milloin liikennesuunnitelman $\P$ parametrisaatio $\chi$ on myös liikennesuunnitelma.
\begin{definition} \label{def:parameterizedTP}
    Olkoon $\Omega \subset \R$ Lebesgue-mitallinen ja Lebesgue-mitaltaan äärellismittainen. Mitallinen kuvaus $\chi: \Omega \times \R^+ \to X$ on \textbf{parametrisoitu liikennesuunnitelma}, jos $t\to \chi(w,t)$ on 1-Lipschitz kaikille $\omega \in \Omega$ ja
    \[\int_\Omega T_\chi (\omega) \, \d \omega < \infty .\]
\end{definition}

Eritellään vielä käyttöön otetut merkinnät ja nimetään ne.
\begin{definition}
    Olkoon $\Omega\subset \R$ mitallinen ja äärellismittainen. Olkoon lisäksi $\chi$ liikennesuunnitelman $\P$ parametrisoitu liikennesuunnitelma.
    \begin{itemize}
        \item Funktio $(\omega, t) \mapsto \chi(\omega, t)$ on parametrisoitu liikennesuunnitelma. 
        \item Polku $t \mapsto \chi(\omega, t)$ ja sen kuvajoukko ovat molemmat \textit{säikeitä}.
    \end{itemize}
\end{definition}

Osoitetaan vielä, että parametrisoidulla liikennesuunnitelmalla $\chi$ määritelty mitta $\chi_\#\lambda$ on myös liikennesuunnitelma. Tätä varten tarvitaan seuraavaa muuttujanvaihtolausetta.

\begin{theorem}\label{thm:push-cov}
    Olkoon Borelin avaruudet $(X_1, \Sigma_1)$ ja $(X_2, \Sigma_2)$, mitalliset kuvaukset $f: X_1 \to X_2$ ja $g: X_2 \to \R^+$, sekä mitta $\mu:\Sigma_1 \to [0, \infty]$. Mikäli $g$ on $f_\#\mu$-integroituva tai $g \circ f$ on $\mu$-integroituva, niin tällöin
    
    \begin{equation*}
        \int_{X_2} g \, d(f_{\#} \mu) = \int_{X_1} g \circ f \, d\mu.
    \end{equation*}
\end{theorem}
\begin{proof}
LÄHDE?
\end{proof}

\begin{theorem}
    Olkoon $\chi : \Omega \times \R^+ \to X$ parametrisoitu liikennesuunnitelma.
    Määritellään mitta $\P_\chi : K \to \Omega$ siten, että \[\P_\chi (E) = \lambda(\chi^{-1}(E)) = \chi_\#\lambda(E)\] jokaiselle Borelin joukolle $E\subset K$. 
    Tällöin $\P_\chi$ on \textit{liikennesuunnitelma}. 
\end{theorem}

\begin{proof}
Osoitetaan, että $\P_\chi$ toteuttaa Määritelmän \ref{def:liikennesuunnitelma}. Lauseella \ref{thm:push-cov} saadaan oletusten ollessa voimassa, että
\begin{align*}
    \int_K T(\gamma)\, d\P_\chi(\gamma) =& \int_K T(\gamma) \, d(\chi_\# \lambda(\omega)) \\
    \stackrel{\ref{thm:push-cov}}{=}& \int_\Omega T(\chi(\omega)) \, d\lambda(\omega) \\
    =& \int_\Omega T_\chi(\omega) \, d\omega \stackrel{\ref{def:parameterizedTP}}{<} \infty.
\end{align*}
Tarkistetaan vielä, että oletukset täyttyvät. Avaruudet $K$ ja $\Omega$ ovat metrisiä avaruuksia. Siispä ne voidaan varustaa Borelin sigma-algebroilla, jolloin saadaan tarvittavat Borelin avaruudet. Funktio $\chi:\Omega \to X$ on mitallinen Lemman \ref{le:chiMeasurable} nojalla. Myöhemmin tullaan osoittamaan Lemmassa \ref{le:pysahtymisajan&pituudenLSC} pysähtymisaika $T$ alhaalta puolijatkuvaksi, jolloin Lemman \ref{le:LSCimpliesMeasurable} nojalla $T$ on mitallinen. 
\end{proof}



\section{Liikennesuunnitelmien {stabiliteetti}}
Tässä kappaleessa perehdytään liikennesuunnitelmien heikkoon suppenemiseen, ja pysähtymisajan sekä pituuden puolijatkuvuuteen. Määritellään ensin funktion kantaja.

\begin{definition}
    Olkoon funktio $f:A \to \R$, missä $A\subset \R^n$. Funktion $f$ kantaja $\supp(f)$ on funktion $f$ määrittelyjoukon osajoukko, jossa funktio $f$ saa nollasta poikkeavia arvoja, eli
    \begin{equation*}
        \supp(f) = \{x \in X : f(x) \ne 0\}.
    \end{equation*}
\end{definition}
Jatkossa rajoitamme tarkastelun jatkuviin funktioihin, joiden kantaja on kompakti.
\begin{definition}
    Olkoon funktio $f: A \to \R$, missä $A\subset \R^n$ Jos funktio $f$ on jatkuva joukossa $A$, niin merkitään $f \in C(A)$ tai $f \in C(A, \R)$. Jos lisäksi funktion $f$ kantaja on kompakti, merkitään $f \in C_c(A)$.
\end{definition}

Liikennesuunnitelmista $\P_n$ muodostuvan jonon $(\P_n)$ heikko suppeneminen määritellään seuraavasti.

\begin{definition} \label{def:weakConv}
    Olkoon $\P \in \mathcal{P}(X)$ liikennesuunnitelma metrisessä avaruudessa $(X, d)$. Liikennesuunnitelmien $\P_n \in \mathcal{P}(X)$ jono $(\P_n)$ suppenee heikosti, merkitään $\P_n \rightharpoonup \P$, jos pätee 
    \begin{equation*}
        \lim_{n\to\infty} \int_X f(x) \, d\P_n (x) = \int_X f(x) \, d\P(x)
    \end{equation*}
    kaikilla $f \in C_c(X)$.
\end{definition}

Liikennesuunnitelmien heikon suppenemisen määritelmä vastaa yleisen mitan heikon suppenemisen määritelmää. (LÄHDE?) Sovitaan vielä, mitä tarkoitetaan liikennesuunnitelmien suppenemisella.

\begin{definition}
    Olkoon $\P_n$ jono liikennesuunnitelmia. Sanotaan, että jono $\P_n$ suppenee kohti liikennesuunnitelmaa $\P$, jos 
    $$\P_n \rightharpoonup \P \, \text{ tai}$$
    $$ \chi_n (\omega) \to  \chi (\omega) \text{ joukossa } K \text{ melkein kaikille } \omega
    \in \Omega,$$
    missä $ \chi_n$ ja $ \chi$ ovat Lauseen \ref{thm:skorohkod} mitalliset funktiot liikennesuunnitelmille $\P_n$ ja $\P$ vastaavassa järjestyksessä.
\end{definition}

\subsubsection{Pituuden, pysähdysajan, keskipituuden ja keskipysähdymisajan alhaalta puolijatkuvuus}

\begin{lemma}\label{le:LSCisLimitOfC-Functions}
    Jokainen alhaalta puolijatkuva funktio $f$ kompaktissa metrisessä avaruudessa on jatkuvien funktioiden kasvavan jonon raja-arvo.
\end{lemma}
\begin{proof}
    Todistus mukailee todistusta \cite[p. 30]{OptimalTransportationNetworks}. Olkoon $f:\R^n \to \R$ alhaalta puolijatkuva. Asetetaan $\displaystyle f_k(x) := \inf_y\{f(y) + kd(x,y)\}$. Tällöin $f_k$ on \whytho{jatkuva} kaikilla $k$. Lisäksi selvästi $f_1 \le f_2 \le ... \le f$. Lisäksi kaikille $x\in \R^n$ pätee $f_k(x) \to f(x)$ kun $k \to \infty$. Siispä
    \begin{equation*}
        \liminf_k f_k(x) = \liminf_k (f(x_k) + kd(x_k, x)) \ge \liminf_k f(x_k) \ge f(x)
    \end{equation*}
\end{proof}

\begin{lemma}\label{le:fdPLeLiminf}
    Olkoon $(\P_n)$ jono positiivisia mittoja kompaktissa metrisessä avaruudessa $K$ siten, että $\P_n \rightharpoonup \P$. Olkoon $\gamma \mapsto f(\gamma)$ alhaalta puolijatkuva funktio avaruudessa $K$. Tällöin
    \begin{equation*}
        \int_K f(\gamma) \, d\P(\gamma) \le \liminf_n \int_K f(\gamma) \, d\P_n(\gamma).
    \end{equation*}
\end{lemma}
\begin{proof}
    Funktio $f$ on alhaalta puolijatkuva, joten Lemman \ref{le:LSCisLimitOfC-Functions} nojalla $f$ voidaan esittää jatkuvien funktioiden kasvavan jonon $(f_k)$ raja-arvona, jolloin kaikilla $k \in \N$ pätee $f_k(\gamma) \le f(\gamma)$, joten
    \begin{equation*}
        \liminf_n \int_K f_k(\gamma) \, d\P_n(\gamma) \le \liminf_n \int_K f(\gamma)\, d\P_n(\gamma).
    \end{equation*}
    Koska $\P_n \rightharpoonup \P$ ja $f_k$ on jatkuva kaikilla $k \in \N$, niin heikon suppenemisen Määritelmän \ref{def:weakConv} nojalla
    \begin{equation*}
        \int_K f_k(\gamma) \, d\P(\gamma) = \liminf_{n} \int_K f_k(\gamma)\, d\P_n(\gamma).
    \end{equation*}
    Yhdistämällä edelliset kaksi tulosta, saadaan epäyhtälö
    \begin{equation*}\label{eq:mainThmMonoConv}
        \int_K f_k(\gamma) \, d\P(\gamma) \le \liminf_n \int_K f(\gamma) \, d\P_n(\gamma).
    \end{equation*}
    Koska $(f_k)$ on kasvava mitallisten funktioiden jono, niin Monotonisen konvergenssin lauseen \ref{thm:monoConvThm} nojalla 
    \begin{equation*}
        \int_K f(\gamma) \, d\P(\gamma) = \lim_{k\to \infty}\int_K f_k(\gamma)\, d\P(\gamma) 
    \end{equation*}
    joten
    \begin{equation*}
        \int_K fT(\gamma) \, d\P(\gamma) = \lim_{k\to \infty}\int_K f_k(\gamma)\, d\P(\gamma)  \le \liminf_n \int_K f(\gamma) \, d\P_n(\gamma).
    \end{equation*}
\end{proof}
Osoitetaan, että pysähtymisaika ja pituus ovat alhaalta puolijatkuvia.
\begin{lemma}\label{le:pysahtymisajan&pituudenLSC}
    Olkoon jono polkuja $\gamma_n \in K$ Jos jono $(\gamma_n)$ suppenee polkuun $\gamma \in K$ etäisyyden $d$ suhteen, niin
    \begin{equation*}
        T(\gamma) \le \liminf_n T(\gamma_n),
    \end{equation*}
    ja 
    \begin{equation*}
        L(\gamma) \le \liminf_n L(\gamma_n).
    \end{equation*}
\end{lemma}

Lemmat \ref{le:fdPLeLiminf} ja \ref{le:pysahtymisajan&pituudenLSC} yhdistämällä saadaan suoraan seuraava tulos.
\begin{corollary}\label{le:keskipysahtymisajan&pituudenLSC}
    Jos jono liikennesuunnitelmia $\P_n$ suppenee liikennesuunnitelmaan $\P$, niin 
    \begin{equation*}
        \int_K T(\gamma) \, d\P(\gamma) \le \liminf_n \int_K T(\gamma) \, d\P_n(\gamma),
    \end{equation*}
    ja
    \begin{equation*}
        \int_K L(\gamma) \, d\P(\gamma) \le \liminf_n \int_K L(\gamma) \, d\P_n(\gamma).
    \end{equation*}
\end{corollary}

\section{Liikennesuunnitelman kertaluku ja liikennesuunnitelman ylhäältä puolijatkuvuus}

\begin{definition}
Olkoon $\chi : \Omega \times \R^+ \to X$ liikennesuunnitelman $\P$ parametrisaatio. Määritellään polkuluokka alkiolle $x\in \R^n$ liikennesuunnitelmassa $\chi$ joukkona
\begin{equation*}
    \Omega_x^\chi = \{\omega : x \in \chi(\omega, \R)\}.
\end{equation*}
ja alkion $x$ kertaluvuksi
    \begin{equation*}
        |x|_\chi = |\Omega_x^\chi| = |\P(\{\gamma : \exists t, \gamma(t) = x\}) = |x|_\P.
    \end{equation*}
\end{definition}

Alkion $x\in \R^n$ polkuluokka sisältää ne kaikki säikeiden $\chi$ indeksit $\omega$, jotka kulkevat alkion $x$ kautta. Kertaluku kuvastaa taas sitä, kuinka useasti säie $\chi$ kulkee alkion $x$ kautta.

\begin{theorem} \label{thm:multiplicityXnLeX}
    Olkoon $(\chi_n)$ jono liikennesuunnitelmia, jotka suppenevat liikennesuunnitelmaan $\chi$. Oletetaan, että $\int_\Omega T(\chi_n(\omega))\, d\omega \le C$ jollekin $C$. Tällöin melkein-kaikille $\omega$ pätee
    \begin{equation*}
        \limsup |\chi_n(\omega, t)|_{\chi_n} \le |\chi(\omega, t)|_\chi.
    \end{equation*}
\end{theorem}
\begin{proof}
    Todistus mukailee todistusta \cite[p. 31-32]{OptimalTransportationNetworks}. Merkitään $[x]_\chi := \Omega_x^\chi$, eli alkion $x\in \R^n$ polkuluokkaa $[x]_\chi$. Olkoon $M > 0.$ Markovin epäyhtälön \ref{thm:markov} nojalla saadaan
    \begin{equation*}
        |\{\omega : T(\chi_n(\omega)) > M\}| \le \frac{C}{M|\Omega|} =: \varepsilon.
    \end{equation*}
    Määritellään approksimatiivinen kertaluku
    \begin{equation*}
        [\chi(\omega,t)]_\chi^\varepsilon := \left\{\omega' \in [\chi(\omega, t)]_\chi : T(\chi(\omega')) \le M = \frac{\varepsilon|\Omega|}{C}\right\}.
    \end{equation*}
    Olkoon $\omega' \in \cap_k \cup_{n > k} [\chi_n(\omega, t)]_{\chi_n}$. Tällöin on olemassa jono  indeksejä $n_i$ joka lähestyy ääretöntä, ja ajat $s_i$ joille $\chi_{n_i}(\omega',s_i) = \chi_{n_i}(\omega, t)$. Toisin sanoen, koska $\omega'$ kuuluu samaan polkuluokkaan kuin $\omega$, löydetään ajanhetkelle $t$ ajanhetki $s_i$ siten, että $\chi_{n_i}(\omega',s_i) = \chi_{n_i}(\omega, t)$. Koska $s_i\le T(\chi_{n_i}(\omega) \le M$ on $(s_i)$ rajoitettu jono, on olemassa suppeneva osajono, joka suppenee johonkin $s$. Koska $(\chi_{n_i}(\omega', \cdot))$ on jono 1-Lipschitz-polkuja kompaktilla välillä $[0, M]$, niin se suppenee tasaisesti välillä $[0, M]$, jolloin saadaan $\chi(\omega', s) = \chi(\omega, t)$, koska $\omega' \in [\chi(\omega, t)]_\chi$. Tämä osoittaa sen, että 
    \begin{equation*}
        \cap_k \cup_{n > k} [\chi_n(\omega, t)]_{\chi_n}^\varepsilon \subset [\chi(\omega, t)]_\chi,
    \end{equation*}
    \what{joten}
    %TR: Tuosta inkluusiosta seuraa epäyhtälö esimerkiksi monotonisen konvergenssin kautta (indikaattorifunktioille). Limsup tuosta mitasta on pienempää kuin lim k\to\infty yhdisteen n \ge k mitasta. Tämä jälkimmäinen jono on monotoninen, ja edellisen inkluusion nojalla lim tuon joukon karakterisesta funktiosta on korkeintaan inkluusion oikeanpuoleisen joukon karakterinen funktio. Viimeisessä epäyhtälössä käytetään sitä tietoa, että varsinaisessa kertaluvussa mitataan lisäksi polkuja jotka ovat tuossa korkeintaan epsilon-mittaisessa poikkeusjoukossa (johon siis tungettiin kaikki liian pitkät polut). Mitaltaan siis tuo approximatiivinen ja varsinainen joukko poikkeavat korkeintaan tuon epsilonin verran.
    \begin{equation*}
        \limsup_n |[\chi_n(\omega, t)]_{\chi_n}^\varepsilon| \le |[\chi(\omega, t)]_\chi|.
    \end{equation*}
    Siispä
    \begin{equation*}
        \limsup_n |[\chi_n(\omega, t)_{\chi_n}]| - \varepsilon \le |[\chi(\omega, t)]_\chi|.
    \end{equation*}
\end{proof}
\begin{lemma}\label{le:multiplicityUSC}
    Olkoon $\chi$ parametrisaatio liikennesuunnitelmalle $\P$. Tällöin funktio $x \mapsto |x|_\chi$ on ylhäältä puolijatkuva.
\end{lemma}
\begin{proof}
    \textbf{Ei käytössä.}
    Todistus mukailee lähdettä \cite[p. 32]{OptimalTransportationNetworks}. Merkitään $\phi: x \to |x|_\chi$. Osoitetaan, että jokaiselle $x$, jolle $|x|_\chi < r$, on olemassa pallo $B(x, \varepsilon)$ siten, että kaikille $y \in B(x, \varepsilon)$ pätee $|y|_\chi < r$. Tämä osoittaa, että $\phi^{-1}([0, r[)$ on avoin joukko, josta \what{seuraa} funktion $\phi$ ylhäältä puolijatkuvuus. Osoitetaan väite käänteisellä päättelyllä, olettaen, että $\phi^{-1}([0, r[)$ ei ole avoin. Tällöin pallossa $B(x, \frac{1}{n})$ on olemassa $y_n \in B(x, \frac{1}{n})$, jolle $|y_n|_\chi \ge r$ kaikilla $n\in \N$. Selvästi $\lim_{n\to\infty} y_n = x$. Olkoon
    \begin{equation*}
        \tilde{\Omega} = \bigcap_m \bigcup_{n \ge m} \Omega_{y_n}^\chi.
    \end{equation*}
    Poistamalla tarvittaessa nollamittainen joukko, saadaan $\tilde{\Omega} \subset \Omega_x^\chi$. Jos $\omega \in \tilde{\Omega}$, niin kaikille $m$ on olemassa $n \ge m$ siten, että $\omega \in \Omega_{y_n}^\chi$. Tällöin on olemassa $t_n$ jolle $\chi(\omega, t_n) = y_n$. 
    Koska melkein kaikille $\omega$ pätee $T(\chi(\omega)) < \infty$, jonon $(t_n)$ voidaan olettaa rajoitetuksi. Tällöin on olemassa jonon $(t_n)$ osajono $(t_{n_k})$ jolle $t_{n_k} \to t$ siten, että $\chi(\omega, t) = x$, eli $\omega \in \Omega_x^\chi$. Siispä $|\tilde{\Omega}| \ge |x|_\chi < r$ ja $|\tilde{\omega}| = \lim_m |\bigcup_{n \ge m} \Omega_{y_n} \ge r$.
\end{proof}

\begin{corollary}
    Olkoon $\chi$ parametrisaatio liikennesuunnitelmalle $\P$. Tällöin funktio $(\omega, t) \mapsto |\chi(\omega, t)|_\chi$ on mitallinen.
\end{corollary}

\section{Liikennesuunnitelmien jonokompaktisuus}

\begin{theorem}\label{le:tfPlanWeakConv}
    Jos $(\P_n)$ on jono joukossa $TP_C$ siten että $\P_n \rightharpoonup \P$, niin $\pi(\P_n) \rightharpoonup \pi(\P)$. Lisäksi 
    \begin{equation*}
    \mu^+(\P_n) \rightharpoonup \mu^+(\P) \text{ ja }  \mu^-(\P_n) \rightharpoonup \mu^-(\P) 
    \end{equation*}
    
\end{theorem}
\begin{proof}
    Todistus mukailee lähdettä \cite[p. 33]{OptimalTransportationNetworks} Oletetaan, että $\P_n$ on todennäköisyysmitta korvaamalla $\P_n$ mitalla $\frac{\P_n}{\P_n(K)}$. Merkitään $K_\varepsilon := \{\gamma \in K : T(\gamma) \le M\}$. Tällöin
    \begin{align*}
        \P_n(K\setminus K_\varepsilon) &= \P_n(K\setminus\{\gamma \in K: T(\gamma) \le M\} \\
        &= \P_n(\{\gamma \in K : T(\gamma) > M\}).
    \end{align*}
    Markovin epäyhtälöllä \ref{thm:markov} ja tiedolla $\P_n \in TP_C$ saadaan 
    \begin{equation*}
        \P_n(\{\gamma \in K : T(\gamma) > M\}) \le \frac{1}{M}\int_K |T(\gamma)| \, d\P_n \le \frac{C}{M},
    \end{equation*}
    Asetetaan $\varepsilon := \frac{C}{M}$, jolloin
    \begin{equation*}
        \P_n(K\setminus K_\varepsilon) \le \varepsilon.
    \end{equation*}
    Olkoon $\phi \in C(X\times X, \R)$. Osoitetaan, että tällöin funktio $\gamma \mapsto \phi(\gamma(0), \gamma(M))$ on jatkuva. Koska $\phi$ on jatkuva, riittää osoittaa, että funktio $F: K\to X \times X : \gamma \mapsto (\gamma(0), \gamma(M))$ on jatkuva. Olkoon $\gamma_1, \gamma_2 \in K$. Koska
    \begin{equation*}
        d(\gamma_1, \gamma_2) = \sup_{k\in\N} \frac{1}{k}||\gamma_1-\gamma_2||_{L^\infty([0,k])}
    \end{equation*}
    niin tällöin
    \begin{align*}
        d_X(\gamma_1(0), \gamma_2(0)) + d_X(\gamma_1(M), \gamma_2(M)) &\le \frac{1}{1}||\gamma_1-\gamma_2||_{L^\infty([0,1])} + M\frac{1}{M}||\gamma_1-\gamma_2||_{L^\infty([0,M])} \\
        &\le  d(\gamma_1, \gamma_2) + Md(\gamma_1, \gamma_2) \\
        &\le (M+1)d(\gamma_1, \gamma_2).
    \end{align*}
    Toisin sanoen, $F$ on $(M+1)$-Lipschitz-jatkuva.
    Siispä $\gamma \mapsto \phi(\gamma(0), \gamma(M))$ on jatkuva. Osoitetaan tällä funktiolla, että heikon suppenemisen Määritelmä \ref{def:weakConv} toteutuu. Merkitään $\pi(\P_n) = \pi_{\P_n}$ ja $\pi(\P) = \pi_\P$.  Koska siirtosuunnitelma on määritelty muodossa $\pi_{\P_n} = \pi_\#\P_n$, niin Muuttujanvaihtolauseen \ref{thm:push-cov} nojalla saadaan
    \begin{align*}
        \limsup_{n\to\infty} \int_{X \times X} \phi(x, y) \, d\pi_{\P_n} (x, y) &= \limsup_{n\to\infty} \int_{K} \phi(\pi_{\P_n}(\gamma)) \, d\P_n (\gamma)  
    \end{align*}
    Koska $K = K_\varepsilon \cup K \setminus K_\varepsilon$, niin integraali voidaan paloitella. Saadaan
    \begin{align*}
        \int_{K} \phi(\pi_{\P_n}(\gamma)) \, d\P_n (\gamma) &= \int_{K_\varepsilon} \phi(\pi_{\P_n}(\gamma)) \, d\P_n (\gamma) + \int_{K \setminus K_\varepsilon} \phi(\pi_{\P_n}(\gamma)) \, d\P_n (\gamma) \\
        &\le \int_{K_\varepsilon} \phi(\pi_{\P_n}(\gamma)) \, d\P_n (\gamma) + \P_n(K\setminus K_\varepsilon) ||\phi||_\infty\\
        &\le \int_{K_\varepsilon} \phi(\gamma(0),\gamma(T(\gamma))) \, d\P_n (\gamma) + \varepsilon||\phi||_\infty \\
        &=  \int_{K_\varepsilon} \phi(\gamma(0),\gamma(M)) \, d\P_n (\gamma) + \varepsilon||\phi||_\infty \\
        &\le \int_{K} \phi(\gamma(0),\gamma(M)) \, d\P_n (\gamma) + 2\varepsilon||\phi||_\infty.
    \end{align*}
Siispä 
    \begin{align} \label{eq:tfWeakConv2}
        \limsup_{n} \int_{K} \phi(\pi_{\P_n}(\gamma)) \, d\P_n (\gamma) \le \limsup_n \int_{K} \phi(\gamma(0),\gamma(M)) \, d\P_n (\gamma) + 2\varepsilon||\phi||_\infty.
    \end{align}
Koska $\P_n \rightharpoonup \P$ ja $\gamma \mapsto \phi(\gamma(0), \gamma(M))$ on jatkuva, niin 
    \begin{equation*}
        \limsup_n \int_{K} \phi(\gamma(0),\gamma(M)) \, d\P_n (\gamma) = \int_{K} \phi(\gamma(0),\gamma(M)) \, d\P (\gamma),
    \end{equation*}
jolloin epäyhtälö \eqref{eq:tfWeakConv2} saadaan muotoon
    \begin{align*}
        \limsup_{n} \int_{K} \phi(\pi_{\P_n}(\gamma)) \, d\P_n (\gamma) \le \int_{K} \phi(\gamma(0),\gamma(M)) \, d\P (\gamma) + 2\varepsilon||\phi||_\infty.
    \end{align*}
Lisäksi saadaan
    \begin{align*}
        \int_K \phi(\gamma(0),\gamma(M)) \, d\P (\gamma) &\le \int_{K_\varepsilon} \phi(\gamma(0),\gamma(M)) \, d\P (\gamma) + \varepsilon||\phi||_\infty \\
        &=\int_{K_\varepsilon} \phi(\gamma(0),\gamma(T(\gamma))) \, d\P (\gamma) + \varepsilon||\phi||_\infty \\
        &\le \int_{K} \phi(\gamma(0),\gamma(T(\gamma))) \, d\P (\gamma) + 2\varepsilon||\phi||_\infty.
    \end{align*}
Siispä
    \begin{equation*}
        \limsup_{n} \int_{K} \phi(\pi_{\P_n}(\gamma)) \, d\P_n (\gamma) \le \int_{K} \phi(\gamma(0),\gamma(T(\gamma))) \, d\P (\gamma) + 4\varepsilon||\phi||_\infty.
    \end{equation*}
Muuttujanvaihtolauseen \ref{thm:push-cov} mukaan voidaan integraalit korvata siten, että
    \begin{equation*}
        \limsup_{n\to\infty} \int_{X \times X} \phi(x, y) \, d\pi_{\P_n} (x, y) \le \int_{X \times X} \phi(x, y) \, d\pi_{\P} (x, y) + 4\varepsilon||\phi||_\infty.
    \end{equation*}
Vastaavasti voidaan osoittaa, että 
    \begin{equation*}
        \liminf_{n\to\infty} \int_{X \times X} \phi(x, y) \, d\pi_{\P_n} (x, y) \ge \int_{X \times X} \phi(x, y) \, d\pi_{\P} (x, y) - 4\varepsilon||\phi||_\infty.
    \end{equation*}

Koska $\phi$ on mielivaltainen funktio ja $\varepsilon > 0$, niin $\pi_{\P_n} \rightharpoonup \pi_\P$.
\end{proof}

\begin{corollary}
    Olkoon $\pi$ mitta joukossa $X \times X$. Tällöin on olemassa liikennesuunnitelma $\P$ siten, että $\pi_\P = \pi$.
\end{corollary}

\chapter{Liikennesuunnitelman energia ja sen minimoijan olemassaolo}
 Sovitaan, että $0^{\alpha - 1} = \infty$, kun $\alpha \in [0, 1]$.

\begin{definition}\label{def:energyOfP}
    Olkoon $\alpha \in [0, 1]$ ja $\P$ liikennesuunnitelma parametrisaatiolla $\chi$. Liikennesuunnitelman $\P$ energia on \define{funktionaali}
        \begin{equation*}
            \E^\alpha(\P) = \int_\Omega \int_{\R^+} |\chi(\omega, t)|_\chi^{\alpha-1}|\dot \chi(\omega, t)|\, dtd\omega,
        \end{equation*}
\end{definition}
    
\begin{remark}\label{thm:energyOfPIndependent}
    Olkoon $\alpha \in [0, 1].$ Liikennesuunnitelman $\P$ energia voidaan esittää muodossa
    \begin{equation*}
        \E^\alpha(\P) = \int_K \int_{\R^+}|\gamma(t)|^{\alpha-1}_\P|\dot\gamma(t)| \, dtd\P(\gamma).
    \end{equation*}
\end{remark}
\begin{proof}
    Todistetaan muuttujanvaihtolauseella \ref{thm:push-cov}.
\end{proof}

Jatkon kannalta on helpompaa käsitellä liikennesuunnitelmia $\P$, jotka sisältävät vain säikeitä $\chi$, joiden nopeus on yksi, eli $\dot\chi(\omega, t) = 1$ kaikilla $(\omega, t) \in \Omega \times \Rp$. Osoitetaan, että liikennesuunnitelmalle $\P$ löytyy liikennesuunnitelma $\tilde \P$, jonka säikeet on parametrisoitu pituuden mukaan ja sen energia säilyy samana kuin liikennesuunnitelman $\P$.

\begin{lemma}
    Olkoon $\chi : [0, 1] \to K$ liikennesuunnitelman $\P$ parametrisaatio. Olkoon $S:[0,1]\times \Rp \to \Rp$ funktio, jolle $S(\omega, t)$ on 1-Lipschitz-jatkuva ja kasvava kaikilla $t \in \Rp$. Olkoon $\tau:[0, 1] \times [0, \infty [ \to \Rp$ ja määritellään
    \begin{equation*}
        \tau(\omega, s) := \inf \{t \in [0, \infty[ : S(\omega, t)\}.
    \end{equation*}
    Oletetaan, että $\tau$ on mitallinen. Tällöin $\tilde\chi(\omega, t) = \chi(\omega, \tau(\omega, t))$ on mitallinen.
\end{lemma}
\begin{proof}
    Todistus löytyy lähteestä \cite[p.44]{OptimalTransportationNetworks}
\end{proof}

\begin{lemma}\label{le:parametrizedByLength}
    Olkoon $\chi:[0,1] \to K$ liikennesuunnitelman $\P$ parametrisaatio. Olkoon 
    \begin{equation*}
        S(\omega, t) = \int_0^t|\dot\chi(\omega, r)| \, dr,
    \end{equation*}
    ja asetetaan
    \begin{equation*}
        T(\omega, s) = \inf\{t \in [0,\infty[ : S(\omega, t) = s\}.
    \end{equation*} 
    Olkoon $\tilde \chi(\omega, s) = \chi(\omega, T(\omega, s))$. Tällöin $\tilde\chi$ on Lebesgue-mitallinen ja liikennesuunnitelman jokainen säie on parametrisoidu pituuden mukaan. Lisäksi, kun $\tilde \P = \tilde \chi_\# \lambda $, niin $\E^\alpha(\tilde\P) = \E^\alpha(\P)$.
\end{lemma}

\begin{proof}
    Todistus löytyy lähteestä \cite[p.40]{OptimalTransportationNetworks}.
\end{proof}

Edellisessä lemmassa $T$ antaa ensimmäisen ajanhetken, jolloin ollaan kuljettu matka $s$.

\begin{lemma}\label{le:nrgGeThanLength}
    Olkoon $P \in \mathcal{P}(K)$ liikennesuunnitelma. Tällöin
        \begin{equation*}
            \E^\alpha(\P) \ge \int_K L(\gamma) \, d\P(\gamma).
        \end{equation*}
\end{lemma}

\begin{proof}
    Todistus mukailee todistusta \cite[p. 36]{OptimalTransportationNetworks}. Lauseen \ref{thm:energyOfPIndependent} nojalla energia voidaan kirjoittaa muodossa
    \begin{equation*}
        \E^\alpha(\P) = \int_K \int_{\R^+}|\gamma(t)|^{\alpha-1}_\P|\dot\gamma(t)| \, dtd\P(\gamma).
    \end{equation*}
     Koska liikennesuunnitelman $\P$ massa on 1, niin kaikkien pisteiden $x \in \R^n$ kertaluku on oltava pienempää kuin 1, eli  $|x|_\P \le 1$. Koska $\alpha \in [0, 1]$, niin  $|x|^{\alpha-1}_\P \ge 1$, jolloin erityisesti $|\gamma(t)|^{\alpha-1}_\P \ge 1$ kaikilla $t \in \Rp$. Tällöin
    \begin{align*}
        \E^\alpha(\P) &= \int_K \int_{\R^+}|\gamma(t)|^{\alpha-1}_\P|\dot\gamma(t)| \, dtd\P(\gamma) \\ 
        &\ge \int_K \int_{\R^+}|\dot\gamma(t)| \, dtd\P(\gamma) = \int_K L(\gamma) \, d\P(\gamma).
    \end{align*}
\end{proof}

Seuraavia lemmoja tarvitaan osoittamaan energian alhaalta puolijatkuvuus.
\begin{lemma} \label{le:indFct}
    Olkoon $(t_n)$ jono reaalilukuja ja $t\in \R$.
    Jos $\displaystyle 0 \le t \le \liminf_{n\to\infty} t_n < \infty$, niin kaikilla $s \in \Rp$ pätee
         \begin{equation*}
             \indfct{[0, t[}(s) \le \liminf_{n\to\infty} \indfct{[0, t_n[}(s)
         \end{equation*}
 \end{lemma}
\begin{proof}
    Olkoon $s \in \Rp$. Jos $s \ge t$, niin $\indfct{[0, t[}(s) = 0$, jolloin väite on selvästi totta.
    Jos $s < t$, ala-raja-arvon määritelmän nojalla on olemassa $n_0 \in \N$, s. e. $s < t_n$ kaikilla $n \ge n_0$. Tästä seuraa, että
        \begin{equation*}
            \liminf_{n \to \infty} \indfct{[0, t_n[}(s) = 1.
        \end{equation*}
    Koska $\indfct{[0, t[}(s) \le 1$, on väite todistettu.
\end{proof}


\begin{lemma}\label{le:intRFctLSC} 
    Olkoon integroituvat funktiot $f, f_n : \Omega \to \R$, $\Omega \subset \R$. Oletetaan, että $\displaystyle \liminf_{n\to\infty} f_n(\omega) \ge f(\omega)$ melkein kaikilla $\omega \in \Omega$. Tällöin
        \begin{equation*}
            \liminf_{n\to \infty} \int_\Omega f_n(\omega) \, d\omega \ge \int_\Omega f(\omega)\, d\omega.
        \end{equation*}
\end{lemma}
\begin{proof}
    \begin{align*}
        \int_\Omega f(\omega) \, d\omega &\le \int_\Omega \liminf_n f_n(\omega) \, d\omega \\
        & = \int_\Omega \lim_{n\to\infty} \inf_{k\ge n} f_k(\omega) \, d\omega
    \end{align*}
 Mitallisten funktioiden jono $(\inf_{k\ge n}f_k(\omega))_k$ on kasvava, jolloin Monotonisen konvergenssilauseen \ref{thm:monoConvThm} nojalla voidaan raja-arvon ja integroinnin järjestys vaihtaa, joten
    \begin{align*}
         \int_\Omega \lim_{n\to\infty} \inf_{k\ge n} f_k(\omega) \, d\omega &= \lim_{n\to\infty} \int_\Omega \inf_{k\ge n} f_k(\omega) \, d\omega \\
        &\le  \liminf_{n\to\infty} \int_\Omega f_n(\omega) \, d\omega 
    \end{align*}
\end{proof}

\begin{theorem}\label{thm:energyLSC}
    Jos $(\P_n)_n$ on jono yksi-massaisia liikennesuunnitelmia joukossa $TP_C$ siten, että $\P_n \rightharpoonup \P$, niin
        \begin{equation*}
            \E^\alpha(\P) \le \liminf_n \E^\alpha(\P_n).
        \end{equation*}
\end{theorem}

\begin{proof}
    Todistus mukailee todistusta \cite[p. 37]{OptimalTransportationNetworks}. Lemman \ref{le:parametrizedByLength} nojalla voidaan olettaa, että liikennesuunnitelman $\P_n$ säikeet on parametrisoitu siten, että 
    \begin{equation}
         \E^\alpha(\P) = \int_\Omega \int_{\R^+}|\chi(\omega, t)|^{\alpha-1}_\chi|\dot\chi(\omega)| \, dtd\omega = \int_\Omega \int_{0}^{L(\chi(\omega, t))}|\chi(\omega, t)|^{\alpha-1}_\chi \, dtd\omega.
    \end{equation}
    
    Osoitetaan, että
    \begin{equation}\label{eq:eLSC1}
      \liminf_{n} \int_0^{L(\chi_n(\omega))}|\chi_n(\omega, t)|_{\chi_n}^{\alpha-1}\, dt \ge \int_0^{L(\chi(\omega))}|\chi(\omega, t)|_{\chi}^{\alpha-1} \, dt,
    \end{equation}
    jolloin voidaan käyttää Lemmaa \ref{le:intRFctLSC}.
    Olkoon $\indfct{}$ \define{indikaattorifunktio.} Tällöin epäyhtälön \ref{eq:eLSC1} vasen puoli voidaan kirjoittaa muotoon.
    \begin{align*}
        \liminf_{n} \int_0^{L(\chi_n(\omega))} |\chi_n(\omega, t)|_{\chi_n}^{\alpha-1} \, dt &= \liminf_{n} \int_0^\infty |\chi_n(\omega, t)|_{\chi_n}^{\alpha-1} \indfct{[0,L(\chi_n(\omega))[}(t) \, dt \\
        &\ge \liminf_n \int_\Rp \inf_{k \ge n} |\chi_k(\omega, t)|_{\chi_k}^{\alpha-1} \indfct{[0, L(\chi_k(\omega))[}(t) \, dt \\
        &=\lim_{n\to \infty} \int_\Rp \inf_{k \ge n} |\chi_k(\omega, t)|_{\chi_k}^{\alpha-1} \indfct{[0, L(\chi_k(\omega))[}(t) \, dt \\
        &=: \lim_{n \to \infty}  \int_\Rp f_n(t) \, dt,
    \end{align*}
    kun määritellään $f_n: \Rp \to [0, \infty]$, $\displaystyle f_n(t) = \inf_{k \ge n} |\chi_k(\omega, t)|_{\chi_k}^{\alpha-1} \indfct{[0, L(\chi_k(\omega))[}(t)$ kaikilla $t \in \Rp$ ja $n \in \N$. Funktiojono $(f_n)$ on kasvava ja jonon alkiot ovat mitallisia, jotenMonotonisen konvergenssilauseen \ref{thm:monoConvThm} nojalla 
    \begin{align*}
        \lim_{n \to \infty}  \int_\Rp f_n(t) \, dt &= \int_\Rp \lim_{n\to\infty}f_n(t) \, dt \\
        &= \int_\Rp \lim_{n \to \infty}  \inf_{k \ge n} |\chi_k(\omega, t)|_{\chi_k}^{\alpha-1} \indfct{[0, L(\chi_k(\omega))[}(t) \, dt \\
        &= \int_\Rp \liminf_{n} |\chi_n(\omega, t)|_{\chi_n}^{\alpha-1} \indfct{[0, L(\chi_n(\omega))[}(t) \, dt.
    \end{align*}
    Jos $\displaystyle \liminf_n |\chi_n(\omega, t)|_{\chi_n}^{\alpha-1} \ge |\chi(\omega, t)|_{\chi}^{\alpha-1}$ ja $\displaystyle \liminf_n \indfct{[0, L(\chi_n(\omega))[}(t) \ge \indfct{[0, L(\chi(\omega))[}(t)$, niin
    \begin{align*}
        % \int_\Rp \liminf_{n} |\chi_n(\omega, t)|_{\chi_n}^{\alpha-1} \indfct{[0, L(\chi_n(\omega))[}(t) \, dt &\ge \int_\Rp|\chi(\omega, t)|_{\chi}^{\alpha-1} \indfct{[0, L(\chi(\omega))[}(t) \, dt \\
        &= \int_0^{L(\chi(\omega))} |\chi(\omega, t)|_{\chi}^{\alpha-1} \, dt,
    \end{align*}
    mikä osoittaa väitteen \eqref{eq:eLSC1}. Osoitetaan, että $\displaystyle \liminf_n |\chi_n(\omega, t)|_{\chi_n}^{\alpha-1} \ge |\chi(\omega, t)|_{\chi}^{\alpha-1}$ ja lisäksi, että $\displaystyle \liminf_n \indfct{[0, L(\chi_n(\omega))[}(t) \ge \indfct{[0, L(\chi(\omega))[}(t)$.
    Lauseen \ref{thm:multiplicityXnLeX} nojalla pätee
    \begin{align*}
        \limsup_n|\chi_n(\omega, t)|_{\chi_n} \le |\chi(\omega, t)|_\chi,
    \end{align*}
    ja kun $\alpha \in [0, 1]$, niin 
    \begin{align*}
        \limsup_n|\chi_n(\omega, t)|_{\chi_n}^{\alpha-1} \le |\chi(\omega, t)|_\chi^{\alpha-1},
    \end{align*}
    josta seuraa, että
    \begin{align*}
        \liminf_n\frac{1}{|\chi_n(\omega, t)|_{\chi_n}^{1-\alpha}} \ge \frac{1}{|\chi(\omega, t)|_{\chi}^{1-\alpha}},
    \end{align*}
    eli
    \begin{align*}
        \liminf_n{|\chi_n(\omega, t)|_{\chi_n}^{\alpha-1}} \ge |\chi(\omega, t)|_{\chi}^{\alpha-1},
    \end{align*}
    mitä haluttiin osoittaa. Koska $L(\chi(\omega)) \le \liminf_n L(\chi_n(\omega)) < \infty$, niin soveltamalla Lemmaa \ref{le:indFct}, saadaan
    \begin{equation*}
        \indfct{[0, L(\chi(\omega))[}(t) \le \liminf_{n} \indfct{[0, L(\chi_n(\omega))[}(t),
    \end{equation*}
    mitä haluttiin osoittaa.
    
    Edellinen päättely osoitti väitteen \ref{eq:eLSC1}. Soveltamalla Lemmaa \ref{le:intRFctLSC} saadaan
    \begin{equation*}
        \liminf_n \int_\Omega \int_0^{L(\chi_n(\omega))}|\chi_n(\omega, t)|_{\chi_n}^{\alpha-1} \, dtd\omega\ge \int_0^{L(\chi(\omega))}|\chi(\omega, t)|_{\chi}^{\alpha-1} \, dtd\omega
    \end{equation*}
    Kaikki polut  $\chi(\omega) \in K$ ovat 1-Lipschitz-jatkuvia, jolloin $|\dot \chi(\omega, t)| \le 1$ kaikilla $t \in \R^+$. Siispä

    \begin{align*}
         \liminf_n \E^\alpha(\P_n) &=  \liminf_n \int_\Omega \int_0^{L(\chi_n(\omega))}|\chi_n(\omega, t)|_{\chi_n}^{\alpha-1} \\
         &\ge \int_0^{L(\chi(\omega))}|\chi(\omega, t)|_{\chi}^{\alpha-1} \, dtd\omega \\
         &\ge \int_0^{L(\chi(\omega))}|\chi(\omega, t)|_{\chi}^{\alpha-1}|\dot \chi(\omega, t)| \, dtd\omega = \E^\alpha(\P).
    \end{align*}
    
\end{proof}


\begin{theorem}
    Olkoon todennäköisyysmitat $\mu^+$ ja $\mu^-$ joukossa $K $. Merkitään mitat $\mu^+$ ja $\mu^-$ \define{yhdistävää} liikennesuunnitelmien kokoelmaa $TP(\mu^+, \mu^-)$.
    
    Oletetaan, että on olemassa ainakin yksi liikennesuunnitelma $\P'$ joka yhdistää mitat $\mu^+$ ja $\mu^-$ äärellisellä energialla $\E^\alpha(P')$. Tällöin on olemassa liikennesuunnitelma $\P \in TP(\mu^+, \mu^-)$, joka minimoi energian $\E^\alpha$.
    
    %Vastaavasti, jos on olemassa ainakin yksi liikennesuunnitelma, jolle $\pi_\P' = \pi$, niin on olemassa liikennesuunnitelma $\P \in TP(\mu^+, \mu^-)$, joka minimoi energian $\E^\alpha$.
\end{theorem}
\begin{proof}
    
    Oletuksen nojalla on olemassa liikennesuunnitelma $\P'$, jolle $\E^\alpha(\P') < \infty$.
    Tällöin jokaiselle $n\in\N$ on olemassa liikennesuunnitelma $\P_n'\in TP(\mu^+, \mu^-)$ siten, että 
        \begin{equation*}
            \E^\alpha(\P_n') \le \inf \{\E^\alpha(\P): \P\in TP(\mu^+, \mu^-)\} + \frac{1}{n}.
        \end{equation*}
    
    Koska $\P_n' \in TP(\mu^+, \mu^-)$ ja $\mu^+$, sekä $\mu^-$ ovat todennäköisyysmittoja, niin $\P_n'$ on todennäköisyysmitta kaikilla $n \in \N$.
    
    Olkoon jono $(\P_n')$ liikennesuunnitelmia, jonka alkiot saadaan edellisen perusteella. Lemman \ref{le:parametrizedByLength} perusteella voidaan olettaa, että liikennesuunnitelman $\P'$ säikeet $\chi'(\omega)$ on parametrisoitu pituuden mukaan. Merkitään tällä tavoin parametrisoituja säikeitä $\gamma$, jolloin $L(\gamma) = T(\gamma)$. 
    
    Koska liikennesuunnitelmat $\P_n'$ ovat kompaktin metrisen avaruuden $K$ todennäköisyysmittoja, niin Lauseen $\define{X}$ nojalla on olemassa jonon $(\P_n')$ osajono $(\P_n)$, joka suppenee heikosti johonkin avaruuden $K$ mittaan $\P$. Osoitetaan, että rajamitta $\P$ on liikennesuunnitelma.
    
    Lemman \ref{le:pysahtymisajan&pituudenLSC} nojalla saadaan
    \begin{equation*}
       \lim_{k\to \infty}\int_K T_k(\gamma)\, d\P(\gamma)  \le \liminf_n \int_K T(\gamma) \, d\P_n(\gamma).
    \end{equation*}
    Polut ovat parametrisoituja pituuden mukaan, siispä {$T(\gamma) = L(\gamma)$}. Lemman \ref{le:nrgGeThanLength} nojalla epäyhtälön oikeaa puolta voidaan arvioida ylhäältäpäin, jolloin saadaan
    \begin{align*}
        \int_K T(\gamma) \, d\P(\gamma) &\le \liminf_n \int_K T(\gamma) \, d\P_n(\gamma) \\
        & = \liminf_n \int_K L(\gamma) \, d\P_n(\gamma) \\
        & \le \liminf_n \E^\alpha(\P_n) < \infty,
    \end{align*}
    sillä $\P_n$ on liikennesuunnitelma kaikilla $n \in \N$. Siispä $\P$ on liikennesuunnitelma. Koska $\P_n \rightharpoonup \P$, niin Lauseen \ref{le:tfPlanWeakConv} nojalla $\pi_{\P_n} \rightharpoonup \pi_{\P}$, ja siten $\mu^+ = \pi_{0\#} \P$ ja $\mu^- = \pi_{\infty \#} \P$, joten $\P$ yhdistää mitat $\mu^+$ ja $\mu^-$. Siispä $\P \in TP(\mu^+, \mu^-)$. Lauseen \ref{thm:energyLSC} perusteella saadaan
    \begin{align*}
        \E^\alpha(\P) &\le \liminf_n \E^\alpha (\P_n) \\
        &\le \liminf_n \left\{\inf\{\E^\alpha(\P): \P\in TP(\mu^+, \mu^-)\} + \frac{1}{n}\right\} \\
        &= \inf\{\E^\alpha(\P): \P\in TP(\mu^+, \mu^-)\},
    \end{align*}
    joten liikennesuunnitelma $\P$ on energian $\E^\alpha$ minimoija.
\end{proof}


\subfile{sections/references}
\end{document}

%\chapter{Liikennesuunnitelmat}
%\subfile{sections/definitions} 
%\subfile{sections/trafficplans}